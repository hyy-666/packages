include $(TOPDIR)/rules.mk

PKG_NAME:=aria2
PKG_VERSION:=1.35.0
PKG_RELEASE:=2021.02.19
PKG_INSTALL:=1
PKG_BUILD_PARALLEL:=1

ifeq ($(ARCH),i386)
	PKG_ARCH_ARIA2:=i386
endif

ifeq ($(ARCH),x86_64)
	PKG_ARCH_ARIA2:=amd64
endif

ifeq ($(ARCH),aarch64)
	PKG_ARCH_ARIA2:=arm64
endif

PKG_SOURCE:=aria2-$(PKG_VERSION)-static-linux-$(PKG_ARCH_ARIA2).tar.gz
PKG_SOURCE_URL:=https://github.com/P3TERX/aria2-builder/releases/download/$(PKG_VERSION)_$(PKG_RELEASE)/
UNTAR_DIR:=$(BUILD_DIR)/$(PKG_NAME)
PKG_HASH:=skip

include $(INCLUDE_DIR)/package.mk
include $(INCLUDE_DIR)/nls.mk

define Package/aria2
	SECTION:=net
	CATEGORY:=Network
	SUBMENU:=File Transfer
	TITLE:=lightweight download utility
	URL:=https://github.com/P3TERX/Aria2-Pro-Core
	DEPENDS:=+bash +curl +findutils +jq +@(i386||x86_64||aarch64)
	USERID:=aria2=6800:aria2=6800
endef

define Package/aria2/description
  aria2 is a lightweight multi-protocol & multi-source command-line download
  utility
endef

define Build/Prepare
	mkdir -vp $(UNTAR_DIR)
	tar -zxvf $(DL_DIR)/$(PKG_SOURCE) -C $(UNTAR_DIR)
endef

define Build/Configure
endef

define Build/Compile
endef

define Package/aria2/conffiles
	/etc/config/aria2
endef

define Package/aria2/install
	$(INSTALL_DIR) $(1)/usr/bin
	$(INSTALL_BIN) $(UNTAR_DIR)/aria2c $(1)/usr/bin
	chmod 755 $(1)/usr/bin/aria2c

	$(INSTALL_DIR) $(1)/etc/init.d
	$(INSTALL_BIN) ./files/aria2.init $(1)/etc/init.d/aria2

	$(INSTALL_DIR) $(1)/etc/config
	$(INSTALL_CONF) ./files/aria2.conf $(1)/etc/config/aria2
endef

$(eval $(call BuildPackage,aria2))